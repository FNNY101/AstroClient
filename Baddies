-- Load Fluent and setup
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

-- Create the Fluent window
local Window = Fluent:CreateWindow({
    Title = "AstroClient",
    SubTitle = "Made by Finny<3",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.RightControl
})

-- Create tabs
local Tabs = {
    Main = Window:AddTab({ Title = "Main" }),
    Settings = Window:AddTab({ Title = "Settings" }) -- Added Settings Tab
}
--Anti Afk
for _, v in next, getconnections(plr.Idled) do 
    v:Disable() 
end

-- Initialize autofarm toggle
local autofarmEnabled = false

local AutofarmToggle = Tabs.Main:AddToggle("AutofarmToggle", {
    Title = "Enable Autofarm",
    Default = false
})

AutofarmToggle:OnChanged(function(value)
    autofarmEnabled = value
    getgenv().farm = autofarmEnabled -- Set global farm variable based on toggle state
end)

-- Autofarm functionality
local plr = game.Players.LocalPlayer
local cash = workspace.Cash
local dmg = workspace.Damageables


local function getMoney()
    local cashPickedUp = false
    for _, m in pairs(cash:GetChildren()) do
        -- Increase the pickup radius by modifying the magnitude comparison
        if m.Name == "Cash" and (m.Position - plr.Character.HumanoidRootPart.Position).magnitude <= 100 then
            cashPickedUp = true
            fireproximityprompt(m.ProximityPrompt, 6)
            task.wait(0.1) -- Adjusted cash pickup time
        end
    end
    return cashPickedUp
end

while getgenv().farm do
    pcall(function()
        for _, a in ipairs(dmg:GetChildren()) do
            if not getgenv().farm then
                break
            end
            if a.Damageable.Value > 0 then
                -- Skip ATMs with the part name "CashRegister"
                if a.Name == "CashRegister" then
                    continue
                end

                -- Teleport to the ATM
                plr.Character.HumanoidRootPart.CFrame = a.Screen.CFrame * CFrame.new(0, 0, 2)
                task.wait(1)
                
                -- Break the ATM and pick up cash within range
                repeat
                    if not getgenv().farm then
                        break
                    end
                    plr.Character.HumanoidRootPart.CFrame = a.Screen.CFrame * CFrame.new(0, 0, 2)
                    game:GetService("ReplicatedStorage"):WaitForChild("PUNCHEVENT"):FireServer(1)
                    task.wait(0.5)
                until a.Damageable.Value <= 0
                
                -- Wait for 2 seconds to pick up cash
                local endTime = tick() + 2
                local cashPickedUp
                repeat
                    if not getgenv().farm then
                        break
                    end
                    cashPickedUp = getMoney()
                    task.wait(0.1)
                until tick() >= endTime and not cashPickedUp
                
                -- If no cash was picked up, move to the next ATM
                if not cashPickedUp then
                    task.wait(1)
                end
            end
        end
    end)
    task.wait(1)
end

-- Settings and Save Manager Integration
SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)
SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({})
InterfaceManager:SetFolder("FluentScriptHub")
SaveManager:SetFolder("FluentScriptHub/specific-game")
InterfaceManager:BuildInterfaceSection(Tabs.Settings) -- Added settings section
SaveManager:BuildConfigSection(Tabs.Settings) -- Added config section
Window:SelectTab(1)
SaveManager:LoadAutoloadConfig()
